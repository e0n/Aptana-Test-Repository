<!--
  User: Tobi
  Date: 24.10.2012
 -->

<!DOCTYPE html>
<html>
<head>
    <style>
        body {
            margin: 1px;
            padding: 1px;
        }
        canvas {
            border: 1px solid #c3c3c3;
        }
    </style>
    <script>
        //variable for the sum of Nodes - is on 2 because of 2 standard nodes already existing

        var markedNode;
        var markedNodeFillBackup;

        //Function for Mouse Location
        function writeMessage(messageLayer, message) {
            var context = messageLayer.getContext();
            messageLayer.clear();
            context.font = '18pt Calibri';
            context.fillStyle = 'black';
            context.fillText(message, 10, 25);
            context.fillText(sumOfNodes, 250, 25);
        }


        // Marks nodes and saves fill color
        function clickNode(node, layer) {
            showselecedNodeMenu(node, layer);
            markedNode.fillBackground(markedNodeFillBackup);
            markedNode.hideAnchors();
            if(markedNode.childElements.length != 0 && markedNode.areThereHiddenChildren == false){
                markedNode.newHideButton.hide();
            }
            //markedNode.shape.setFill(markedNodeFillBackup);
            markedNode = node;
            markedNodeFillBackup = markedNode.getBackground();//markedNode.shape.getFill();
            markedNode.fillBackground('#3D9DB3');
            markedNode.showAnchors();
            if(markedNode.childElements.length != 0 && markedNode.areThereHiddenChildren == false){
                markedNode.newHideButton.show();
            }
            //markedNode.shape.setFill('green');

            layer.draw();
        }

        //onload function
        window.onload = function() {
            var stage = new Kinetic.Stage({
                container: "container",
                width: 1750,
                height: 890
            });


            //Layer for shapes
            var layer = new Kinetic.Layer();
            // MessageLayer for Mouseposition and other debug notes
            var messageLayer = new Kinetic.Layer();


            // Oval Shape 1
            var base = new newNodeFactory.createBaseNode(stage, layer);

            markedNode = base;
            markedNodeFillBackup = base.getBackground();
            markedNode.fillBackground('#3D9DB3');


            //Oval Shape 2
            var rectNode = new newNodeFactory.newRectNode(layer, base);


            //Button for showing the marked node
            //this functionality would be used later for hide/minimize (and reshow) parts of the mindmap
            var newShowButton = debugGUI.buildNewShowButton();
            newShowButton.on("click", function(){
                markedNode.showChildren(layer);
            });
            layer.add(newShowButton);

            //Button for hiding the marked node
            //this functionality would be used later for hide/minimize parts of the mindmap
            var newHideButton = debugGUI.buildNewHideButton();
            newHideButton.on("click", function(){
                markedNode.hideChildren(layer);
            });
            layer.add(newHideButton);

            //Button for FactoryMethod of creating new Nodes
            var newEllipseButton = debugGUI.buildNewEllipseButton();
            newEllipseButton.on("click", function(){
                new newNodeFactory.newEllipseNode(layer, markedNode);
            });
            layer.add(newEllipseButton);

            var newRectButton = debugGUI.buildNewRectButton();
            newRectButton.on("click", function(){
                new newNodeFactory.newRectNode(layer, markedNode);
            });
            layer.add(newRectButton);

            var newEditTextButton = debugGUI.buildNewEditTextButton();
            newEditTextButton.on("click", function(){
                var newText=prompt("Please enter a new name", markedNode.getText());
                if (newText !=null )
                {
                    markedNode.setText(newText);
                }
            });
            layer.add(newEditTextButton);

            var nodeToCopy;
            //Button for copying a node
            var newLoadMapButton = debugGUI.buildNewMenuButton();
            newLoadMapButton.setText('Copy');
            newLoadMapButton.setPosition(770, 120);
            newLoadMapButton.on("click", function(){
                nodeToCopy = markedNode;
            });
            layer.add(newLoadMapButton);

            //Button for pasting a node
            var newLoadMapButton = debugGUI.buildNewMenuButton();
            newLoadMapButton.setText('Paste');
            newLoadMapButton.setPosition(900, 120);
            newLoadMapButton.on("click", function(){
                var nodeToPaste = new newNodeFactory.newRectNode(layer, markedNode);
                var text = nodeToCopy.getText();
                nodeToPaste.setText(text);
            });
            layer.add(newLoadMapButton);


            //function for mouse coordinates on shape - only for debugging and development
            stage.on("mousemove", function() {

                var mousePos = stage.getMousePosition();
                writeMessage(messageLayer, 'x: ' + mousePos.x + ', y: ' + mousePos.y);
            });


            // add the layer to the stage
            stage.add(layer);
            stage.add(messageLayer);
        };


    </script>

</head>
<body>
<header>
    <div id="welcome">
        Welcome, <?=$this->username?><br>
        <a id="logoutAction" href="login/logout" >Click here to logout</a>
    </div>
    <div id="mainmenu">
        <div id="menubutton"></div>
        <div id="menubody">
            <div id="overlay"></div>
            <div id="menuPointer"></div>
            <div id="new"></div>
            <div id="save"></div>
            <div id="load"></div>
            <div id="import"></div>
            <div id="export"></div>
            <div id="logout"></div>
            <a href="#" id="text"></a>
        </div>
    </div>
</header>
    <div id="container"></div>
</body>
<footer>
    <div align="center" >Copyright Â© Open Your Mind 2012-2013</div>
    <div id="selectedNodeMenu" style="display: none;">
        <div id="top">
            <select id="font">
                <option id="0">Times New Roman</option>
                <option id="1">Arial</option>
                <option id="2">serif</option>
                <option id="3">sans-serif</option>
                <option id="4">cursive</option>
                <option id="5">fantasy</option>
                <option id="6">monospace</option>
            </select>
            <select id="size">
                <option id="8">8</option>
                <option id="9">9</option>
                <option id="10">10</option>
                <option id="11">11</option>
                <option id="12">12</option>
                <option id="14">14</option>
                <option id="16" selected="selected">16</option>
                <option id="18">18</option>
                <option id="20">20</option>
                <option id="24">24</option>
                <option id="28">28</option>
                <option id="32">32</option>
                <option id="36">36</option>
                <option id="48">48</option>
            </select>
        </div>
        <div id="bottom">
            <a href="#" id="bold"><b>F</b></a>
            <a href="#" id="italic"><i>K</i></a>
            <a href="#" id="underline"><u>U</u></a>
            <div id="colorSelector"></div>
            <div id="borderColorSelector"></div>
        </div>
    </div>
</footer>
</html>